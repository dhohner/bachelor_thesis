webpackJsonp([2],{340:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={PQ_ENTRY_CATEGORY:"PQ Entry",ACTION_MODAL_FLOW:"Modal Login",OREILLY_HOST:"www.oreilly.com",LEARNING_OREILLY_HOST:"https://learning.oreilly.com",SAFARI_DOMAIN:"https://www.safaribooksonline.com"},e.exports=t.default},807:function(e,t,a){a(140),e.exports=a(808)},808:function(e,t,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}a(809);var r=a(2),n=_interopRequireDefault(r),i=a(180),o=a(339),s=_interopRequireDefault(o),l=(a(340),a(810)),u=_interopRequireDefault(l),c=new s.default(window.location.search),d=document.getElementsByTagName("html")[0],f={readingUrl:c.get("next")||d.getAttribute("data-reading-url")||d.getAttribute("data-url"),signInUrl:"/accounts/login/?next="+(c.get("next")||d.getAttribute("data-url")),forceShow:window.location.href.search(/\?ar/)>=0||parseInt(d.getAttribute("data-force-show"),10)>0,redirectToSafari:window.location.hostname.search("www.oreilly.com")>=0&&!c.get("tofupqtest"),ssoMsgTimeoutMs:4e3},m=document.createElement("div");m.id="academic-modal",document.getElementsByTagName("body")[0].appendChild(m),console.log("test"),(0,i.render)(n.default.createElement(u.default,f),m)},810:function(e,t,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),n=a(2),i=_interopRequireDefault(n),o=a(14),s=_interopRequireDefault(o),l=a(339),u=_interopRequireDefault(l),c=a(811),d=_interopRequireDefault(c),f=a(93),m=_interopRequireDefault(f),p=a(340),h=function(e){function StudentIntercept(e){_classCallCheck(this,StudentIntercept);var t=_possibleConstructorReturn(this,(StudentIntercept.__proto__||Object.getPrototypeOf(StudentIntercept)).call(this,e)),a=new u.default(window.location.search);return t.state={show:!1,universityLogo:"",uiState:"capture",email:a.get("email")||"",timestamp:a.get("tstamp")||"",signature:a.get("id")||"",error:""},t.analytics=new m.default,t.get(t.modifyPathIfHostNameMatches("/api/v1/account-summary-by-network/")).then(function(a){if(a.sso_login_url)setTimeout(function(){t.redirectToSsoLoginUrl(a.sso_login_url)},e.ssoMsgTimeoutMs);else{if(t.props.redirectToSafari){var r=t.returnWindowPathName();r=window.location.search?""+p.SAFARI_DOMAIN+r+window.location.search+"&orpq":""+p.SAFARI_DOMAIN+r+"?orpq",t.redirectToSafariUrl(r)}t.trackOpen()}var n="capture";t.state.email&&t.state.timestamp&&t.state.signature?(n="ezproxy-sso",t.registerUser()):a.sso_login_url&&(n="sso");var i={show:!0,universityLogo:a.logo,uiState:n};t.setState(i)}).catch(function(){if(t.props.forceShow)if(t.props.redirectToSafari){var e=t.returnWindowPathName();e=window.location.search?""+p.SAFARI_DOMAIN+e+window.location.search+"&orpq":""+p.SAFARI_DOMAIN+e+"?orpq",t.redirectToSafariUrl(e)}else t.trackOpen(),t.setState({show:!0})}),t.determineSsoStatus=t.determineSsoStatus.bind(t),t.handleInputChange=t.handleInputChange.bind(t),t.handleStartReading=t.handleStartReading.bind(t),t.registerUser=t.registerUser.bind(t),t}return _inherits(StudentIntercept,e),r(StudentIntercept,[{key:"track",value:function(e,t,a){this.analytics.track(e,t,a)}},{key:"trackOpen",value:function(){this.track(p.PQ_ENTRY_CATEGORY,p.ACTION_MODAL_FLOW,"modal view")}},{key:"trackSubmitEmail",value:function(){this.track(p.PQ_ENTRY_CATEGORY,p.ACTION_MODAL_FLOW,"submit email")}},{key:"trackStartsReading",value:function(){this.track(p.PQ_ENTRY_CATEGORY,p.ACTION_MODAL_FLOW,"temp access")}},{key:"handleStartReading",value:function(){this.trackStartsReading()}},{key:"handleInputChange",value:function(e){this.setState({email:e.target.value})}},{key:"returnWindowPathName",value:function(){return window.location.pathname}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return fetch(e,{method:"GET",credentials:"same-origin"}).then(function(e){if(!e.ok){var a=new Error(e.statusText);throw a.response=e,a}return t?e.text():e.json()})}},{key:"post",value:function(e,t){return fetch(e,{method:"POST",body:JSON.stringify(t),credentials:"same-origin"}).then(function(e){if(!e.ok){if(422===e.status)return e.json().then(function(e){var t=new Error;throw t.response=e,t});throw new Error(e.statusText)}return e.json()})}},{key:"redirectToSsoLoginUrl",value:function(e){window.location.replace(e+"&state="+encodeURIComponent(this.props.readingUrl))}},{key:"redirectToSafariUrl",value:function(e){window.location.replace(e)}},{key:"modifyPathIfHostNameMatches",value:function(e){return"www.oreilly.com"===window.location.hostname?""+p.LEARNING_OREILLY_HOST+e:e}},{key:"determineSsoStatus",value:function(){var e=this,t=this.state.email.split("@");if(2===t.length)return this.get(this.modifyPathIfHostNameMatches("/api/v1/sso/account/lookup?domain="+t[1])).then(function(t){e.setState({uiState:"loading"}),e.redirectToSsoLoginUrl(t.sso_login_url)}).catch(function(t){e.registerUser()});this.registerUser()}},{key:"registerUser",value:function(){var e=this,t=this.state,a=t.email,r=t.timestamp,n=t.signature,i={email:a,timestamp:r,signature:n};this.props.forceShow&&(i.ar=!0),this.setState({uiState:"loading"}),this.post(this.modifyPathIfHostNameMatches("/api/v1/user/pq-student/"),i).then(function(){e.trackSubmitEmail(),e.setState({uiState:"success"})}).catch(function(t){if(t.response){var a=t.response.email||t.response.non_field_errors||"";e.setState({error:a,uiState:"capture"})}else e.setState({error:"",uiState:"failure"})})}},{key:"renderEmailEntry",value:function(){var e=this.state,t=e.universityLogo,a=e.email,r=e.uiState,n=e.error;e.csrfToken;return i.default.createElement(d.default,{universityLogo:t},i.default.createElement("div",{className:"attention"},i.default.createElement("p",null,"Welcome!"),i.default.createElement("p",null,"Get instant access through your library.")),i.default.createElement("div",{className:"messaging"},i.default.createElement("p",null,"Just enter your academic institution email below:"),i.default.createElement("div",{className:"input-container"+(n?" error":"")},i.default.createElement("input",{type:"text",name:"email",placeholder:"Academic email",value:a,onChange:this.handleInputChange,ref:function(e){return e&&e.focus()}})),n?i.default.createElement("small",{className:"error"},n):"",i.default.createElement("p",null,i.default.createElement("a",{href:this.modifyPathIfHostNameMatches(this.props.signInUrl)},"Already a user? Click here.")),i.default.createElement("p",null,"We will use your personal data in accordance with our ",i.default.createElement("a",{href:"/privacy"},"Privacy Policy"),".")),i.default.createElement("div",{className:"buttonBox"},"loading"===r?i.default.createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):i.default.createElement("button",{className:"cta",onClick:this.determineSsoStatus},"Let's Go")))}},{key:"renderSuccessMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(d.default,{className:"successModal",universityLogo:e},i.default.createElement("div",{className:"attention centered"},i.default.createElement("span",null,"You're in!")),i.default.createElement("div",{className:"messaging centered"},i.default.createElement("p",null,"Want more? Check your email for details on how to set up an account. It's free for students.")),i.default.createElement("div",{className:"buttonBox"},i.default.createElement("a",{className:"cta",href:this.modifyPathIfHostNameMatches(this.props.readingUrl),onClick:this.handleStartReading},"Got It")))}},{key:"renderFailureMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(d.default,{universityLogo:e},i.default.createElement("div",{className:"attention centered error"},i.default.createElement("div",null,i.default.createElement("img",{className:"error-alert",src:"/library/view/static/images/icons/exclamation-alert.svg",alt:"Alert"})),"An error has occurred with the site."),i.default.createElement("div",{className:"messaging centered error"},i.default.createElement("p",null,"Please go back and re-enter your email address.")),i.default.createElement("div",{className:"buttonBox"},i.default.createElement("button",{className:"cta",onClick:function(){return window.location.reload(!0)}},"Try Again")))}},{key:"renderSsoMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(d.default,{className:"ssoModal",universityLogo:e},i.default.createElement("div",{className:"attention centered"},i.default.createElement("span",null,"Welcome to Safari!")),i.default.createElement("div",{className:"messaging centered"},i.default.createElement("p",null,"You have a free Safari account, courtesy of this library. Please wait while we connect.")))}},{key:"render",value:function(){var e=this.state,t=e.show,a=e.uiState;return t?"ezproxy-sso"==a?this.renderSsoMessage():"success"===a?this.renderSuccessMessage():"failure"===a?this.renderFailureMessage():"sso"==a?this.renderSsoMessage():this.renderEmailEntry():null}}]),StudentIntercept}(n.Component);h.propTypes={readingUrl:s.default.string.isRequired,signInUrl:s.default.string.isRequired,forceShow:s.default.bool.isRequired,ssoMsgTimeoutMs:s.default.number.isRequired},t.default=h,e.exports=t.default},811:function(e,t,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(2),n=_interopRequireDefault(r),i=a(14),o=_interopRequireDefault(i),s=function(e){var t=e.children,a=e.universityLogo;return n.default.createElement("div",{className:"backdrop"},n.default.createElement("div",{className:"modal "+e.className},n.default.createElement("div",{className:"header"},a?n.default.createElement("img",{className:"uni-logo",src:a,alt:"University logo"}):"",n.default.createElement("img",{className:"brand-logo",src:"/library/view/static/images/brand/red_orm_safari.svg",alt:"Safari"})),n.default.createElement("div",{className:"content"},t)))};s.propTypes={children:o.default.oneOfType([o.default.arrayOf(o.default.node),o.default.node]),className:o.default.string,universityLogo:o.default.string},t.default=s,e.exports=t.default},93:function(e,t,a){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),n=a(1),i=function(e){return e&&e.__esModule?e:{default:e}}(n),o=function(){function Analytics(){_classCallCheck(this,Analytics)}return r(Analytics,[{key:"initialize",value:function(){var e=this;(0,i.default)(".ga-start-viewing-content").on("click",function(){var t=(0,i.default)(this).text().indexOf("reading")>-1?"Book":"Video";e.track("Anybird","View Content Preview",t)}),(0,i.default)("*[data-ga-label]").on("click",function(){var t=(0,i.default)(this).attr("data-ga-label");e.track("Anybird","Trial Register",t)}),(0,i.default)(".ga-latest-edition-title").on("click",function(){e.track("Anybird","Get Latest Edition")})}},{key:"track",value:function(e,t,a){if(!window.ga||!window.ga.loaded){var r=this;return void setTimeout(function(){r.track(e,t,a)},50)}ga("send","event",e,t,a)}}]),Analytics}();t.default=o,e.exports=t.default}},[807]);